<!DOCTYPE html>
<html lang="en">
<head>
    <title>Beverage Quality Predictor</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background: linear-gradient(135deg, #0f5132, #198754);
            min-height: 100vh;
        }
        .card {
            border-radius: 16px;
        }
        .btn-premium {
            background: #198754;
            color: white;
            font-weight: 600;
        }
        .btn-premium:hover {
            background: #157347;
        }
        .section-title {
            font-weight: 600;
            color: #0f5132;
        }
    </style>
</head>

<body>

<div class="container mt-5 mb-5">
    <div class="card shadow-lg p-4">

        <h2 class="text-center mb-1">üç∫ Beverage Quality Predictor</h2>
        <p class="text-center text-muted mb-4">
            Data ‚Ä¢ Image ‚Ä¢ Analytics ‚Ä¢ Demo-Ready
        </p>

        <!-- FORM -->
        <form method="POST" action="/predict" enctype="multipart/form-data">

            <h5 class="section-title mb-3">Chemical Properties</h5>

            <div class="row">
                <div class="col-md-6">
                    <input type="number" step="any" class="form-control mb-2" id="fixed_acidity" name="fixed_acidity" value="7.4">
                    <input type="number" step="any" class="form-control mb-2" id="volatile_acidity" name="volatile_acidity" value="0.70">
                    <input type="number" step="any" class="form-control mb-2" id="citric_acid" name="citric_acid" value="0.00">
                    <input type="number" step="any" class="form-control mb-2" id="residual_sugar" name="residual_sugar" value="1.9">
                    <input type="number" step="any" class="form-control mb-2" id="chlorides" name="chlorides" value="0.076">
                    <input type="number" step="any" class="form-control mb-2" id="free_sulfur_dioxide" name="free_sulfur_dioxide" value="11">
                </div>

                <div class="col-md-6">
                    <input type="number" step="any" class="form-control mb-2" id="total_sulfur_dioxide" name="total_sulfur_dioxide" value="34">
                    <input type="number" step="any" class="form-control mb-2" id="density" name="density" value="0.9978">
                    <input type="number" step="any" class="form-control mb-2" id="pH" name="pH" value="3.51">
                    <input type="number" step="any" class="form-control mb-2" id="sulphates" name="sulphates" value="0.56">
                    <input type="number" step="any" class="form-control mb-2" id="alcohol" name="alcohol" value="9.4">
                </div>
            </div>

            <h5 class="section-title mt-4 mb-2">Image (Optional)</h5>
            <input type="file" class="form-control mb-3" name="image">

            <!-- CONTROLS -->
            <div class="d-flex flex-wrap gap-2 mb-3">
                <button type="button" class="btn btn-outline-secondary" onclick="resetSample()">Reset to Sample</button>
                <button type="button" class="btn btn-outline-primary" onclick="randomSample()">Random Sample</button>
                <button type="button" class="btn btn-outline-success" onclick="autoDemo()">Auto-Fill Demo</button>
            </div>

            <!-- TOGGLE -->
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="useSampleToggle" checked>
                <label class="form-check-label">
                    Use sample data if inputs are empty
                </label>
            </div>

            <button class="btn btn-premium w-100">Predict Quality</button>
        </form>

        <!-- ERROR -->
        {% if error %}
        <div class="alert alert-danger mt-4 text-center">{{ error }}</div>
        {% endif %}

        <!-- RESULT -->
        {% if quality %}
        <div class="alert alert-{{ color }} mt-4 text-center">
            <h4>{{ label }}</h4>
            <p><strong>Score:</strong> {{ quality }}</p>
            <p><strong>Mode:</strong> {{ mode }}</p>
            <p><strong>Confidence:</strong> {{ confidence }}%</p>
        </div>

        <!-- ANALYTICS -->
        <div class="row mt-4">
            <div class="col-md-4"><canvas id="qualityChart"></canvas></div>
            <div class="col-md-4"><canvas id="confidenceChart"></canvas></div>
            <div class="col-md-4"><canvas id="sourceChart"></canvas></div>
        </div>

        <script>
        (function(){
            const q = {{ quality|tojson }};
            const c = {{ confidence|tojson }};
            const dq = {{ data_quality|tojson }};
            const iq = {{ image_quality|tojson }};

            new Chart(document.getElementById("qualityChart"), {
                type: "bar",
                data: {
                    labels: ["Low", "Average", "High"],
                    datasets: [{
                        data: [
                            q <= 4 ? q : 0,
                            q > 4 && q <= 6 ? q : 0,
                            q > 6 ? q : 0
                        ],
                        backgroundColor: ["#f8d7da", "#fff3cd", "#d1e7dd"]
                    }]
                },
                options: { plugins:{legend:{display:false}}, scales:{y:{max:8, beginAtZero:true}} }
            });

            new Chart(document.getElementById("confidenceChart"), {
                type: "doughnut",
                data: {
                    labels: ["Confidence", "Remaining"],
                    datasets: [{
                        data: [c, 100 - c],
                        backgroundColor: ["#198754", "#e9ecef"]
                    }]
                },
                options:{cutout:"70%"}
            });

            new Chart(document.getElementById("sourceChart"), {
                type: "pie",
                data: {
                    labels: ["Model Data", "Image Analysis"],
                    datasets: [{
                        data: [dq || 0, iq || 0],
                        backgroundColor: ["#0d6efd", "#20c997"]
                    }]
                }
            });
        })();
        </script>
        {% endif %}

        <hr class="mt-5">

        <div class="text-center small text-muted">
            Built by <strong>Sanka Akash</strong><br>
            GitHub: <a href="https://github.com/SANKAAKASH" target="_blank">github.com/SANKAAKASH</a><br>
            HackerRank: <a href="https://www.hackerrank.com/profile/vtu17042" target="_blank">vtu17042</a><br>
            LinkedIn: <a href="https://www.linkedin.com/in/sankaakash/" target="_blank">linkedin.com/in/sankaakash</a><br>
            üìß ursakash9@gmail.com | üìû 9391325606
        </div>

    </div>
</div>

<script>
function resetSample() {
    document.querySelectorAll("input[type=number]").forEach(el => el.value = el.defaultValue);
}

function randomSample() {
    const ranges = {
        fixed_acidity:[4,15], volatile_acidity:[0.1,1.5], citric_acid:[0,1],
        residual_sugar:[0.5,15], chlorides:[0.02,0.2], free_sulfur_dioxide:[1,70],
        total_sulfur_dioxide:[6,300], density:[0.990,1.005], pH:[2.7,4.0],
        sulphates:[0.3,2], alcohol:[8,15]
    };
    Object.keys(ranges).forEach(id=>{
        const [min,max]=ranges[id];
        document.getElementById(id).value=(Math.random()*(max-min)+min).toFixed(2);
    });
}

function autoDemo() {
    resetSample();
}
</script>

</body>
</html>
